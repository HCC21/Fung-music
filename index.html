<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>My Auto Music Player</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
  body { font-family: Arial; background: #121212; color: white; text-align: center; padding: 20px; }

  .player-box { width: 300px; margin: 0 auto; }

  /* é»‘è† å”±ç‰‡ */
  .vinyl {
    width: 250px; height: 250px;
    border-radius: 50%;
    background-size: cover;
    margin: 20px auto;
    animation: spin 6s linear infinite;
    animation-play-state: paused;
  }
  @keyframes spin { 100% { transform: rotate(360deg); } }

  /* æ³¢å½¢å‹•ç•« */
  .bars { display: flex; justify-content: center; margin: 20px 0; }
  .bars div {
    width: 5px; height: 20px; background: #1DB954;
    margin: 0 3px; animation: bounce 0.6s infinite alternate;
  }
  .bars div:nth-child(2) { animation-delay: 0.1s; }
  .bars div:nth-child(3) { animation-delay: 0.2s; }
  .bars div:nth-child(4) { animation-delay: 0.3s; }
  @keyframes bounce { from { height: 10px; } to { height: 40px; } }

  /* æ’­æ”¾æ¸…å–® */
  ul { list-style: none; padding: 0; }
  li { padding: 10px; cursor: pointer; }
  li.active { background: #1DB954; }
</style>
</head>
<body>

<h1>ğŸ§ My Auto Music Player</h1>

<div class="player-box">
  <div id="vinyl" class="vinyl"></div>
  <audio id="player" controls style="width:100%;"></audio>

  <div class="bars">
    <div></div><div></div><div></div><div></div>
  </div>
</div>

<h2>æ’­æ”¾æ¸…å–®</h2>
<ul id="playlist"></ul>

<button id="loopBtn">ğŸ” å¾ªç’°</button>
<button id="shuffleBtn">ğŸ”€ éš¨æ©Ÿ</button>

<script>
let songs = [];
let loop = false;
let shuffle = false;

const player = document.getElementById("player");
const vinyl = document.getElementById("vinyl");
const playlist = document.getElementById("playlist");

async function loadSongs() {
  const response = await fetch("songs.json");
  songs = await response.json();
  buildPlaylist();
  playSong(0);
}

function buildPlaylist() {
  playlist.innerHTML = "";
  songs.forEach((song, index) => {
    const li = document.createElement("li");
    li.innerHTML = `${song.title}<div id="qr${index}"></div>`;
    li.onclick = () => playSong(index);
    playlist.appendChild(li);

    // QR Code
    new QRCode(document.getElementById(`qr${index}`), {
      text: window.location.href.replace("index.html", "") + song.file,
      width: 80, height: 80
    });
  });
}

function playSong(index) {
  const song = songs[index];

  [...playlist.children].forEach(li => li.classList.remove("active"));
  playlist.children[index].classList.add("active");

  player.src = song.file;
  vinyl.style.backgroundImage = `url(${song.cover})`;

  player.play();
  vinyl.style.animationPlayState = "running";

  player.onended = () => {
    if (shuffle) {
      playSong(Math.floor(Math.random() * songs.length));
    } else {
      playSong((index + 1) % songs.length);
    }
  };
}

document.getElementById("loopBtn").onclick = () => {
  loop = !loop;
  player.loop = loop;
  alert(loop ? "å·²é–‹å•Ÿå¾ªç’°æ’­æ”¾" : "å·²é—œé–‰å¾ªç’°æ’­æ”¾");
};

document.getElementById("shuffleBtn").onclick = () => {
  shuffle = !shuffle;
  alert(shuffle ? "å·²é–‹å•Ÿéš¨æ©Ÿæ’­æ”¾" : "å·²é—œé–‰éš¨æ©Ÿæ’­æ”¾");
};

loadSongs();
</script>

</body>
</html>